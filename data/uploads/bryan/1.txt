<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checklist</title>
<style>
  .no-border {
    border: none;
  }
  .bold-text {
    font-weight: bold;
  }
  #dataTable {
    border-collapse: collapse;
    border: 1px solid black; /* Thin border */
    margin-left: auto;
    margin-right: auto;
    width: 80%;
  }
  #dataTable th {
    border: 1px solid black; /* Thin border */
    padding: 8px;
    background-color: #77DD77; /* Background color for column names */
    color: black; /* Text color for column names */
  }
  #dataTable td {
    border: 1px solid black; /* Thin border */
    padding: 8px;
  }
</style>
</head>
<body>

<h1 style="text-align: center;">CHECKLIST</h1>

<!-- Search bar -->
<form id="searchForm" style="text-align: center; margin-bottom: 20px;">
  <input type="text" id="searchInput" placeholder="Search...">
  <button type="submit">Search</button>
</form>

<table id="dataTable">
<?php
// Your MySQL database credentials
$servername = "localhost"; // Change this to your MySQL server address
$username = "root"; // Change this to your MySQL username
$password = "nelsonvalle123456789"; // Change this to your MySQL password
$database = "my_checklist"; // Change this to your MySQL database name
$table1 = "instructor"; // Change this to the name of your first table
$table2 = "subjects"; // Change this to the name of your second table
$common_column = "Course_Code"; // Change this to the common column name
$order_column1 = "Year_Taken"; // Change this to the first column you want to order by in $table1
$order_column2 = "Semester_Taken"; // Change this to the second column you want to order by in $table1

// Create connection
$conn = new mysqli($servername, $username, $password, $database);

// Check connection
if ($conn->connect_error) {
    die("Connection failed: " . $conn->connect_error);
}

// Query to select specific columns from both tables using JOIN and order by columns
$sql = "SELECT * FROM $table1 INNER JOIN $table2 ON $table1.$common_column = $table2.$common_column ORDER BY $order_column1, $order_column2";

// Execute the query
$result = $conn->query($sql);

// Output column names
if ($result->num_rows > 0) {
    echo "<tr>";
    $row = $result->fetch_assoc(); // Fetch a single row to get column names
    foreach ($row as $key => $value) {
        echo "<th>" . str_replace('_', ' ', $key) . "</th>";
    }
    echo "</tr>";

    // Variables to keep track of the current year and semester
    $current_year = "";
    $current_semester = "";

    // Output data of each row
    do {
        // Check if the year or semester has changed
        if ($current_year != $row[$order_column1]) {
            // If it has, output a header row for the new year
            echo "<tr class='no-border bold-text'><td colspan='17'>" . $row[$order_column1] . " </td></tr>";
            $current_year = $row[$order_column1];
        }

        // Output the row data
        echo "<tr>";
        foreach ($row as $value) {
            echo "<td>" . $value . "</td>";
        }
        echo "</tr>";

    } while ($row = $result->fetch_assoc());

} else {
    echo "<tr><td colspan='17'>No data found in joined tables: " . $table1 . " and " . $table2 . "</td></tr>";
}

// Close connection
$conn->close();
?>
</table>

<script>
document.getElementById("searchForm").addEventListener("submit", function(event) {
  event.preventDefault();
  var input = document.getElementById("searchInput").value.toUpperCase();
  var table = document.getElementById("dataTable");
  var rows = table.getElementsByTagName("tr");
  for (var i = 0; i < rows.length; i++) {
    if (rows[i].querySelectorAll("th").length > 0) {
      // Skip table header rows
      continue;
    }
    var cells = rows[i].getElementsByTagName("td");
    var found = false;
    for (var j = 0; j < cells.length; j++) {
      var cellText = cells[j].textContent || cells[j].innerText;
      if (cellText.toUpperCase().indexOf(input) > -1) {
        found = true;
        break;
      }
    }
    if (found) {
      rows[i].style.display = "";
    } else {
      rows[i].style.display = "none";
    }
  }
});
</script>

</body>
</html>
